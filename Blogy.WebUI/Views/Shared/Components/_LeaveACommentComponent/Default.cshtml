@model CreateCommentDto
@*
    _LeaveACommentComponent
*@

<div class="comment-form-wrap pt-5">
    
    @if (User.Identity.IsAuthenticated)
    {
        <h3 class="mb-5">Bir yorum bırakın</h3>
        <form id="contactForm" class="p-5 bg-light">
            <input type="hidden" asp-for="BlogId" />

            <div class="form-group">
                <label for="message">Mesajınız</label>
                <textarea asp-for="Content" id="message" rows="5" class="form-control" required></textarea>
            </div>
            
            <div class="form-group">
                <button type="button" id="btnSend" class="btn btn-primary">Gönder</button>
            </div>
            
            <div id="resultMessage" class="mt-3"></div>
        </form>
    }
    else
    {
        <div class="alert alert-warning p-4 text-center">
            <h4>Yorum yapabilmek için giriş yapmalısınız.</h4>
            <a href="/Login/Index" class="btn btn-dark mt-3">Giriş Yap</a>
        </div>
    }
</div>

<script>
    $(document).ready(function () {
        $("#btnSend").click(function () {
            var formData = $("#contactForm").serialize();

            $.ajax({
                type: "POST",
                url: "/Blog/SendComment",
                data: formData,
                success: function (response) {
                    if (response.success) {
                       
                        $("#resultMessage").html('<div class="alert alert-success">' + response.message + '</div>').fadeIn();
                        $("#contactForm")[0].reset();
                        
                        
                        setTimeout(function() { $("#resultMessage").fadeOut(); }, 3000);
                    } else {
                       
                        $("#resultMessage").html('<div class="alert alert-danger">' + response.message + '</div>').fadeIn();
                    }
                },
                error: function (xhr) {
                    console.log(xhr.responseText);
                    $("#resultMessage").html('<div class="alert alert-danger">Sunucu hatası oluştu.</div>');
                }
            });
        });
    });
</script>